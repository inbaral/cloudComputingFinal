name: assignment3
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Log the time the workflow starts executing
        run: echo $(date -Iminutes)\n >> log.txt
      # Should remove the "/n"?
      - name: Log Submitters names
        run: echo Inbar Alfasi, Ofek Basson\n >> log.txt
      #Should build here only the books image?
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      - name: Build and export
        # Does this push it to dockerhub? I didn't give the username+password
        uses: docker/build-push-action@v5
        with:
          # What is the context?
          context: .
          # What is the .setport?
          file: ./books-service/Dockerfile
          # Should I give that another name like in the lecture (gave it a name with a prefix of the username from github secrets)? Didn't do that
          # Should I save it also with the current time? Didn't do that
          tags: books-service:latest
          outputs: type=docker, dest=/tmp/image.tar
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: books-service
          path: /tmp/image.tar
      # Should be in the end of the workflow
      - name: List files for debugging
        run: ls -alh
      - name: Upload log file
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: log
          path: log.txt


  #test:
  #query: